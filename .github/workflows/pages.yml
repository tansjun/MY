# GitHub Pages 自定义构建部署工作流
# 核心作用：接管原生pages-build-deployment，精准控制构建触发频率
name: Deploy to GitHub Pages

# ========== 核心：触发规则（重点修改这里控频） ==========
on:
  # 手动触发（核心，方便按需部署）
  workflow_dispatch:
  # 2. 自动触发：仅当推送到main分支，且修改了指定目录/文件时才触发（避免无关代码修改触发构建）
  push:
    branches: [ "main" ]  # 改为你的核心分支
    paths: [ # 仅修改以下目录/文件时触发，按需增删
      #"src/**",           # 例如前端源码目录
      "live.txt" # 仅修改live.txt时触发，避免无关修改触发部署
    ] 
    
# ========== 构建部署核心逻辑 ==========
jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # 部署Pages必需的权限
    steps:
      # 步骤1：拉取仓库代码（包含根目录的live.txt）
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 步骤2：设置Node环境（根据你的项目调整版本，如18、20）
      #- name: Setup Node.js
      #  uses: actions/setup-node@v4
      #  with:
      #    node-version: "20"
      #    cache: "npm"    # 缓存npm依赖，加速构建

      # 步骤3：安装依赖（如果是纯静态HTML，可删除此步骤）
      #- name: Install dependencies
      #  run: npm install  # 若用yarn/pnpm，改为yarn install / pnpm install

      # 步骤4：构建项目（如果是纯静态HTML，可删除此步骤）
      #- name: Build project
      #  run: npm run build  # 改为你的构建命令（如yarn build），纯静态HTML则删除
      
      # 步骤5：直接部署根目录文件（核心：仅部署live.txt所在的根目录）
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./  # 关键：部署根目录（live.txt在根目录）
          # 可选：仅部署live.txt（过滤其他文件，更精准）
          # publish_branch: gh-pages  # 部署到gh-pages分支（Pages默认分支）
          exclude_assets: '!live.txt' # 只保留live.txt，排除其他所有文件
