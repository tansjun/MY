# GitHub Pages 自定义构建部署工作流
# 核心作用：接管原生pages-build-deployment，精准控制构建触发频率
name: Deploy to GitHub Pages

# ========== 核心：触发规则（重点修改这里控频） ==========
on:
  # 手动触发（核心，方便按需部署）
  workflow_dispatch:
  # 2. 自动触发：仅当推送到main分支，且修改了指定目录/文件时才触发（避免无关代码修改触发构建）
  push:
    branches: [ "main" ]  # 改为你的核心分支
    paths: [ # 仅修改以下目录/文件时触发，按需增删
      #"src/**",           # 例如前端源码目录
      "live.txt" # 仅修改live.txt时触发，避免无关修改触发部署
    ] 
    
# ========== 构建部署核心逻辑 ==========
jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # 部署Pages必需的权限
    steps:
      # 步骤1：拉取仓库代码（包含根目录的live.txt）
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      # 新增步骤：创建临时目录，只复制live.txt到该目录（更稳妥）
      - name: Prepare deploy files
        run: |
          mkdir -p ./deploy
          cp live.txt ./deploy/  # 只复制live.txt到deploy目录

      # 步骤5：直接部署根目录文件（核心：仅部署live.txt所在的根目录）
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./deploy  # 部署只包含live.txt的目录
          publish_branch: gh-pages  # 部署到gh-pages分支（Pages默认分支）
          force_orphan: true  # 清空gh-pages分支旧内容，避免冗余文件
